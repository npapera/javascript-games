<html>
    <head>
        <title>Breakout Game</title>
    </head>
    <body>
        <div style="text-align:center; margin-top:200px;">
            <canvas height="500" width="500" id="ctx" style="border:2px solid #000000"></canvas>
        </div>
        <script>

            var ctx = document.getElementById('ctx').getContext('2d');
            ctx.font = '20px Calibri';
            var WIDTH = 500;
            var HEIGHT = 500;
            var numOfTiles, tileList, score;
            ctx.font = '20px Calibri';

            var ball = {
                x: 0,
                y: 0,
                radius: 5,
                color: '#000000',
                spdX: 2,
                spdY: 2
            };

            var base = {
                x: 0,
                y: 400,
                height: 10,
                width: 100,
                color: '#000000',
                pressingLeft: false,
                pressingRight: false,
                spdX: 5,
                lives: 3
            };

            var tile = {
                height: 20,
                width: 40,
                color: '#000000'
            };

            document.onkeydown = function(event) {
                if (event.keyCode == 37) {
                    base.pressingLeft = true;
                    base.pressingRight = false;
                } else if (event.keyCode == 39) {
                    base.pressingLeft = false;
                    base.pressingRight = true;
                }
            }

            document.onkeyup = function(event) {
                if (event.keyCode == 37) {
                    base.pressingLeft = false;
                } else if (event.keyCode == 39) {
                    base.pressingRight = false;
                }
            }

            testTopBaseCollision = function(base, ball) {
                return ((base.x < ball.x + ball.radius) &&
                        (ball.x < base.x + base.width) &&
                        (base.y < ball.y + ball.radius) &&
                        (ball.y < base.y + base.height));
            }

            testTileCollision = function(t, ball) {
                return ((t.x < ball.x + ball.radius) &&
                        (ball.x < t.x + tile.width) &&
                        (t.y < ball.y + ball.radius) &&
                        (ball.y < t.y + tile.height));
            }

            drawBall = function() {
                ctx.save();
                ctx.fillStyle = ball.color;
                ctx.beginPath();
                ctx.arc(ball.x, ball.y, ball.radius, 0, 2*Math.PI);
                ctx.fill();
                ctx.restore();
            }

            drawBase = function() {
                ctx.save();
                ctx.fillStyle = base.color;
                ctx.fillRect(base.x, base.y, base.width, base.height);
                ctx.restore();
            }

            drawTile = function(t, i) {
                ctx.save();
                ctx.fillStyle = tile.color;
                ctx.fillRect(t.x, t.y, tile.width, tile.height);
                ctx.restore();
            }

            updateBasePosition = function() {
                if (base.pressingLeft) {
                    base.x = base.x - base.spdX;
                } else if (base.pressingRight) {
                    base.x = base.x + base.spdX;
                }
                if (base.x < 0) {
                    base.x = 0
                }
                if (base.x > WIDTH-base.width) {
                    base.x = WIDTH-base.width;
                }
            }

            updateBallPosition = function() {
                ball.x += ball.spdX;
                ball.y += ball.spdY;
                if(numOfTiles <= 50 && numOfTiles > 40){
                    if (Math.sign(ball.spdX) == -1){
                        ball.spdX = -3;
                    } else {
                        ball.spdX = 3;
                    }
                    if (Math.sign(ball.spdY) == -1){
                        ball.spdY = -3;
                    } else {
                        ball.spdY = 3;
                    }
                } else if (numOfTiles <= 40 && numOfTiles > 30){
                    if (Math.sign(ball.spdX) == -1){
                        ball.spdX = -4;
                    } else {
                        ball.spdX = 4;
                    }
                    if (Math.sign(ball.spdY) == -1){
                        ball.spdY = -4;
                    } else {
                        ball.spdY = 4;
                    }
                } else if (numOfTiles <= 25) {
                    if (Math.sign(ball.spdX) == -1){
                        ball.spdX = -5;
                    } else {
                        ball.spdX = 5;
                    }
                    if (Math.sign(ball.spdY) == -1){
                        ball.spdY = -5;
                    } else {
                        ball.spdY = 5;
                    }
                }
                if ((ball.x+ball.radius) > WIDTH || ball.x-ball.radius < 0) {
                    ball.spdX = -ball.spdX;
                }
                if ((ball.y+ball.radius) > HEIGHT || (ball.y-ball.radius) < 0) {
                    ball.spdY = -ball.spdY;
                }
                if ((ball.y+ball.radius) > HEIGHT) {
                    base.lives--;
                }
            }

            update = function() {
                ctx.clearRect(0,0,WIDTH,HEIGHT);
                tileList.forEach(drawTile);
                drawBall();
                drawBase();
                if (testTopBaseCollision(base, ball)) {
                    ball.spdY = -ball.spdY;
                }
                for (key in tileList) {
                    if (testTileCollision(tileList[key], ball)) {
                        delete tileList[key];
                        ball.spdY = -ball.spdY;
                        numOfTiles--;
                        score += 5;
                    }
                }

                ctx.fillText("Score: "+score, 10, 490);
                ctx.fillText("Lives: "+base.lives, 430, 490);

                updateBasePosition();
                updateBallPosition();
            }

            startGame = function() {
                base.x = WIDTH/2 - base.width/2;
                ball.x =  base.x + 100;
                ball.y = base.y - 150;
                numOfTiles = 0;
                var tileX = 5;
                var tileY = 5;
                tileList = [];
                score = 0;
                base.lives = 3;
                for (var i=1; i<6; i++) {
                    for (var j=1; j<=11; j++) {
                        tileList[numOfTiles] = {x:tileX, y:tileY};
                        numOfTiles++;
                        tileX += 45;
                    }
                    tileX = 5;
                    tileY += 25;
                }
                setInterval(update, 20);
            }

            startGame();

        </script>
    </body>
</html>